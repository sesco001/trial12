<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>User Dashboard</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="navbar">
    <h2>User Dashboard</h2>
    <button onclick="logout()">Logout</button>
  </div>
  <div class="container">
    <h3 id="welcome"></h3>
    <p>Balance: <span id="balance">0</span></p>
    <p>Verified: <span id="verified">false</span></p>
    <p>Your referral link: <input id="refLink" style="width:100%"></p>

    <h3>Assignments Available</h3>
    <div id="assignments"></div>

    <h3>Submit Assignment</h3>
    <form id="submit" enctype="multipart/form-data">
      <input name="title" placeholder="Title" required>
      <textarea name="description" placeholder="Description"></textarea>
      <input name="url" placeholder="Optional URL">
      <textarea name="text" placeholder="Optional text"></textarea>
      <input type="file" name="files" multiple>
      <button>Submit</button>
    </form>
  </div>

  <script src="js/app.js"></script>
  <script>
  async function load() {
    const dash = await apiGet('/user/dashboard');
    document.getElementById('welcome').innerText = dash.welcome;
    document.getElementById('balance').innerText = dash.user.balance;
    document.getElementById('verified').innerText = dash.user.verified;
    const ref = await apiGet('/user/referral');
    document.getElementById('refLink').value = ref.link;

    const list = document.getElementById('assignments');
    list.innerHTML = '';
    dash.assignments.forEach(a=>{
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `<b>${a.title}</b><br>${a.description}`;
      list.appendChild(div);
    });
  }

  document.getElementById('submit').addEventListener('submit', async e=>{
    e.preventDefault();
    const form = new FormData(e.target);
    const r = await fetch(API + '/user/submit', { method:'POST', headers: { Authorization: 'Bearer ' + token }, body: form });
    const data = await r.json();
    alert("Submitted!");
  });

  load();
  </script>
</body>
</html>
